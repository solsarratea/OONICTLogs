# OONICTLogs
Is a project intended to:
- learn go (:-D)
- collect all certificate chains from the webconnectivity OONI measurements to create Certificate Transparency logs, using the Letâ€™s Encrypt testing Twig logs as a target.

## How to: 
## Build
Set parameters on the config.json` and run
`GO111MODULE=auto build -o service main.go` 
`./servcice`

## Develop
There are 2 flags for enabling/disabling go-routines
`GO111MODULE=auto run main.go` // runs both
`GO111MODULE=auto run main.go find`   // run process certificate chains
`GO111MODULE=auto run main.go submit` // run process for submitting certificate chains

### Tests
Unit tests in some packages by running the command: `GO111MODULE=auto test`


## Project structure
It is basically structure using 2 go-routines :D
*WHY?* Is a nice way of sharing memory but being able to handle different time-rates. 

### Finder
Basically, queries and processes all measurements to extract the certificate chains for submission.
*How?*

Loads root certificates from Twig.
Get rawmeasurments from OONI and write indidivual measurements into "raw_measurements.txt"
Process each measurement
    - Read from "raw_measurements.txt" and process each URL:
    - Query to OONI
    - Parse it and get Certificate Chain
    - Look for Root Certificate
    - Write valid cert chain into local directory [*]
    - Delete entry from the "raw_measurements.txt"

### Submitter
Read availables JSON generated by `finder`.
Submits the certificate chains into Twig.


## Improve/TODOs (sorted by priority):
- Update config.json automatically after processing all measurments (last certifiate update since)
- Improve log system: specially for submitter.
- Research on async functions, improve function calls and concurrency
- Do not allow read/write at same time !! (it was OK for testing)
- Automatically update the Twig CTLog according to date/time window
https://letsencrypt.org/docs/ct-logs/#Sunlight
- `utils/` will probably dissappear/be moved to `/common` though was very useful for interacting with APIs during devlopment



#### [*] Valid certificate chains:
From RFC 6962:
- Each submitted certificate MUST be accompanied by all additional certificates required to verify the certificate chain up to an accepted root certificate. 

+ Improve valid cchains
+ Improve unnecesarry submissions